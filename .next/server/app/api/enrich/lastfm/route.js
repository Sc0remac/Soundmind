"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/enrich/lastfm/route";
exports.ids = ["app/api/enrich/lastfm/route"];
exports.modules = {

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fenrich%2Flastfm%2Froute&page=%2Fapi%2Fenrich%2Flastfm%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fenrich%2Flastfm%2Froute.ts&appDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fenrich%2Flastfm%2Froute&page=%2Fapi%2Fenrich%2Flastfm%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fenrich%2Flastfm%2Froute.ts&appDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_cormackerr_Desktop_soundmind_app_api_enrich_lastfm_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/enrich/lastfm/route.ts */ \"(rsc)/./app/api/enrich/lastfm/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/enrich/lastfm/route\",\n        pathname: \"/api/enrich/lastfm\",\n        filename: \"route\",\n        bundlePath: \"app/api/enrich/lastfm/route\"\n    },\n    resolvedPagePath: \"/Users/cormackerr/Desktop/soundmind/app/api/enrich/lastfm/route.ts\",\n    nextConfigOutput,\n    userland: _Users_cormackerr_Desktop_soundmind_app_api_enrich_lastfm_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/enrich/lastfm/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZlbnJpY2glMkZsYXN0Zm0lMkZyb3V0ZSZwYWdlPSUyRmFwaSUyRmVucmljaCUyRmxhc3RmbSUyRnJvdXRlJmFwcFBhdGhzPSZwYWdlUGF0aD1wcml2YXRlLW5leHQtYXBwLWRpciUyRmFwaSUyRmVucmljaCUyRmxhc3RmbSUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmNvcm1hY2tlcnIlMkZEZXNrdG9wJTJGc291bmRtaW5kJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmNvcm1hY2tlcnIlMkZEZXNrdG9wJTJGc291bmRtaW5kJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNrQjtBQUMvRjtBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3NvdW5kbWluZC8/OTg4NSJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvY29ybWFja2Vyci9EZXNrdG9wL3NvdW5kbWluZC9hcHAvYXBpL2VucmljaC9sYXN0Zm0vcm91dGUudHNcIjtcbi8vIFdlIGluamVjdCB0aGUgbmV4dENvbmZpZ091dHB1dCBoZXJlIHNvIHRoYXQgd2UgY2FuIHVzZSB0aGVtIGluIHRoZSByb3V0ZVxuLy8gbW9kdWxlLlxuY29uc3QgbmV4dENvbmZpZ091dHB1dCA9IFwiXCJcbmNvbnN0IHJvdXRlTW9kdWxlID0gbmV3IEFwcFJvdXRlUm91dGVNb2R1bGUoe1xuICAgIGRlZmluaXRpb246IHtcbiAgICAgICAga2luZDogUm91dGVLaW5kLkFQUF9ST1VURSxcbiAgICAgICAgcGFnZTogXCIvYXBpL2VucmljaC9sYXN0Zm0vcm91dGVcIixcbiAgICAgICAgcGF0aG5hbWU6IFwiL2FwaS9lbnJpY2gvbGFzdGZtXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9lbnJpY2gvbGFzdGZtL3JvdXRlXCJcbiAgICB9LFxuICAgIHJlc29sdmVkUGFnZVBhdGg6IFwiL1VzZXJzL2Nvcm1hY2tlcnIvRGVza3RvcC9zb3VuZG1pbmQvYXBwL2FwaS9lbnJpY2gvbGFzdGZtL3JvdXRlLnRzXCIsXG4gICAgbmV4dENvbmZpZ091dHB1dCxcbiAgICB1c2VybGFuZFxufSk7XG4vLyBQdWxsIG91dCB0aGUgZXhwb3J0cyB0aGF0IHdlIG5lZWQgdG8gZXhwb3NlIGZyb20gdGhlIG1vZHVsZS4gVGhpcyBzaG91bGRcbi8vIGJlIGVsaW1pbmF0ZWQgd2hlbiB3ZSd2ZSBtb3ZlZCB0aGUgb3RoZXIgcm91dGVzIHRvIHRoZSBuZXcgZm9ybWF0LiBUaGVzZVxuLy8gYXJlIHVzZWQgdG8gaG9vayBpbnRvIHRoZSByb3V0ZS5cbmNvbnN0IHsgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MgfSA9IHJvdXRlTW9kdWxlO1xuY29uc3Qgb3JpZ2luYWxQYXRobmFtZSA9IFwiL2FwaS9lbnJpY2gvbGFzdGZtL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fenrich%2Flastfm%2Froute&page=%2Fapi%2Fenrich%2Flastfm%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fenrich%2Flastfm%2Froute.ts&appDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/enrich/lastfm/route.ts":
/*!****************************************!*\
  !*** ./app/api/enrich/lastfm/route.ts ***!
  \****************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! @/lib/supabaseAdmin */ \"(rsc)/./lib/supabaseAdmin.ts\");\n// app/api/enrich/lastfm/route.ts\n\n\n/**\n * LAST.FM ENRICHMENT\n * - Looks at your most recent listens (last 100) and enriches their tracks with:\n *   - genre_primary   (string)\n *   - genre_tags      (string[])\n *   - derived_energy  (0..1)\n *   - derived_valence (0..1)\n *\n * We use last.fm track.getTopTags + artist.getTopTags.\n * No user auth: requires LASTFM_API_KEY in env.\n */ const LASTFM_KEY = process.env.LASTFM_API_KEY;\n// Basic tag normalization/aliases\nconst TAG_ALIAS = {\n    \"hip hop\": \"hip-hop\",\n    hiphop: \"hip-hop\",\n    \"lo fi\": \"lo-fi\",\n    lofi: \"lo-fi\",\n    edm: \"edm\",\n    dnb: \"drum-and-bass\",\n    \"drum n bass\": \"drum-and-bass\",\n    \"drum & bass\": \"drum-and-bass\",\n    house: \"house\",\n    techno: \"techno\",\n    trance: \"trance\",\n    ambient: \"ambient\",\n    chill: \"chill\",\n    \"chill out\": \"chill\",\n    rock: \"rock\",\n    metal: \"metal\",\n    pop: \"pop\",\n    trap: \"trap\",\n    dance: \"dance\",\n    \"r&b\": \"rnb\",\n    rnb: \"rnb\"\n};\n// Heuristic maps for deriving energy/valence from tags.\n// NOTE: keys with hyphens MUST be quoted in TS.\nconst TAG_TO_ENERGY = {\n    rave: 0.9,\n    hardstyle: 0.95,\n    edm: 0.8,\n    dance: 0.7,\n    rock: 0.7,\n    techno: 0.8,\n    house: 0.7,\n    chill: 0.2,\n    ambient: 0.1,\n    acoustic: 0.2,\n    downtempo: 0.3,\n    \"lo-fi\": 0.25,\n    lofi: 0.25,\n    pop: 0.6,\n    hiphop: 0.6,\n    \"hip-hop\": 0.6,\n    trap: 0.7,\n    metal: 0.85,\n    trance: 0.75,\n    \"drum-and-bass\": 0.85\n};\nconst TAG_TO_VALENCE = {\n    happy: 0.9,\n    upbeat: 0.8,\n    uplifting: 0.8,\n    melancholic: 0.2,\n    sad: 0.1,\n    dark: 0.2,\n    chill: 0.6,\n    ambient: 0.5,\n    acoustic: 0.7,\n    pop: 0.7,\n    \"hip-hop\": 0.6,\n    hiphop: 0.6,\n    trap: 0.5,\n    techno: 0.4,\n    metal: 0.3,\n    trance: 0.6\n};\n// Useful stopwords we don’t want as “genres”\nconst TAG_STOP = new Set([\n    \"seen live\",\n    \"favorites\",\n    \"favorite\",\n    \"awesome\",\n    \"90s\",\n    \"00s\",\n    \"2010s\",\n    \"2020s\",\n    \"uk\",\n    \"usa\",\n    \"british\",\n    \"swedish\",\n    \"german\",\n    \"female vocalists\",\n    \"male vocalists\"\n]);\nfunction normalizeTag(t) {\n    const s = t.trim().toLowerCase();\n    const clean = s.replace(/\\s+/g, \" \"); // collapse spaces\n    const alias = TAG_ALIAS[clean] || clean;\n    // strip non-word characters except space and hyphen\n    return alias.replace(/[^\\w\\s-]/g, \"\").trim();\n}\nfunction scoreTags(tags) {\n    // Return cleaned, weighted tag list and top candidates for genre_primary\n    const map = new Map();\n    for (const tag of tags || []){\n        if (!tag?.name) continue;\n        let n = normalizeTag(tag.name);\n        if (!n || TAG_STOP.has(n)) continue;\n        const w = Math.max(1, Number(tag.count || 1));\n        map.set(n, (map.get(n) || 0) + w);\n    }\n    // sort by weight desc\n    const entries = [\n        ...map.entries()\n    ].sort((a, b)=>b[1] - a[1]);\n    const ordered = entries.map(([k])=>k);\n    const top = entries.length > 0 ? entries[0][0] : null;\n    return {\n        ordered,\n        top\n    };\n}\nfunction deriveEnergyValence(tags) {\n    if (!tags?.length) return {\n        energy: null,\n        valence: null\n    };\n    let eSum = 0, eN = 0, vSum = 0, vN = 0;\n    for (const t of tags){\n        if (t in TAG_TO_ENERGY) {\n            eSum += TAG_TO_ENERGY[t];\n            eN++;\n        }\n        if (t in TAG_TO_VALENCE) {\n            vSum += TAG_TO_VALENCE[t];\n            vN++;\n        }\n    }\n    return {\n        energy: eN ? Number((eSum / eN).toFixed(3)) : null,\n        valence: vN ? Number((vSum / vN).toFixed(3)) : null\n    };\n}\nasync function lf(method, params) {\n    const url = new URL(\"https://ws.audioscrobbler.com/2.0/\");\n    url.searchParams.set(\"method\", method);\n    url.searchParams.set(\"api_key\", String(LASTFM_KEY));\n    url.searchParams.set(\"format\", \"json\");\n    for (const [k, v] of Object.entries(params))url.searchParams.set(k, v);\n    const r = await fetch(url.toString(), {\n        next: {\n            revalidate: 0\n        }\n    });\n    if (!r.ok) throw new Error(`Last.fm ${method} ${r.status}`);\n    return r.json();\n}\nasync function fetchTagsFor(artist, track) {\n    const tags = [];\n    try {\n        const jt = await lf(\"track.getTopTags\", {\n            artist,\n            track,\n            autocorrect: \"1\"\n        });\n        if (jt?.toptags?.tag?.length) tags.push(...jt.toptags.tag);\n    } catch  {\n    // ignore\n    }\n    // If nothing from track, try artist\n    if (tags.length === 0) {\n        try {\n            const ja = await lf(\"artist.getTopTags\", {\n                artist,\n                autocorrect: \"1\"\n            });\n            if (ja?.toptags?.tag?.length) tags.push(...ja.toptags.tag);\n        } catch  {\n        // ignore\n        }\n    }\n    return tags;\n}\nasync function POST() {\n    if (!LASTFM_KEY) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: false,\n            error: \"Missing LASTFM_API_KEY\"\n        }, {\n            status: 500\n        });\n    }\n    // 1) Find up to 100 tracks that lack genre metadata\n    const { data: tracks, error: tErr } = await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"spotify_tracks\").select(\"id,name,genre_primary,genre_tags,artist_name\").or(\"genre_primary.is.null,genre_tags.is.null\").limit(100);\n    if (tErr) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        ok: false,\n        error: tErr.message\n    }, {\n        status: 500\n    });\n    const trackRows = tracks;\n    if (!trackRows?.length) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        ok: true,\n        updated: 0,\n        processed: 0,\n        note: \"No tracks need tags\"\n    });\n    const ids = trackRows.map((t)=>t.id);\n    // 2) Fetch track-artist links and artist names\n    const [{ data: links }, { data: artists }] = await Promise.all([\n        _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"spotify_track_artists\").select(\"track_id,artist_id\").in(\"track_id\", ids),\n        _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"spotify_artists\").select(\"id,name\")\n    ]);\n    const artistMap = new Map();\n    artists?.forEach((a)=>artistMap.set(a.id, a.name));\n    const trackArtists = new Map();\n    links?.forEach((lnk)=>{\n        const arr = trackArtists.get(lnk.track_id) || [];\n        const nm = artistMap.get(lnk.artist_id);\n        if (nm) arr.push(nm);\n        trackArtists.set(lnk.track_id, arr);\n    });\n    // 3) For each track, call last.fm and update the row\n    let updated = 0;\n    const results = [];\n    for (const tr of trackRows){\n        let artistsForTrack = trackArtists.get(tr.id) || [];\n        if ((!artistsForTrack || artistsForTrack.length === 0) && tr.artist_name) {\n            artistsForTrack = String(tr.artist_name).split(\",\").map((s)=>s.trim()).filter(Boolean);\n        }\n        const artist = artistsForTrack[0] || \"\"; // pick the first (primary) artist\n        if (!artist || !tr.name) continue;\n        const tags = await fetchTagsFor(artist, tr.name);\n        const { ordered, top } = scoreTags(tags);\n        const { energy, valence } = deriveEnergyValence(ordered);\n        const genre_primary = top || tr.genre_primary || null;\n        const genre_tags = ordered.slice(0, 8);\n        const { error: uErr } = await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_1__.supabaseAdmin.from(\"spotify_tracks\").update({\n            genre_primary,\n            genre_tags: genre_tags.length ? genre_tags : null,\n            derived_energy: energy,\n            derived_valence: valence,\n            last_enriched_at: new Date().toISOString(),\n            meta_provider: {\n                ...typeof tr.meta_provider === \"object\" ? tr.meta_provider : {},\n                lastfm: {\n                    ok: true,\n                    tagsFetched: tags.length,\n                    artist,\n                    track: tr.name\n                }\n            }\n        }).eq(\"id\", tr.id);\n        results.push({\n            id: tr.id,\n            track: tr.name,\n            artist,\n            topTag: genre_primary,\n            tagCount: tags.length,\n            updated: !uErr,\n            error: uErr?.message || null\n        });\n        if (!uErr) updated++;\n        // Small delay to be polite to Last.fm\n        await new Promise((r)=>setTimeout(r, 120));\n    }\n    return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n        ok: true,\n        updated,\n        processed: tracks?.length || 0,\n        results\n    });\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFDO2dCQUNsRkMsUUFBUTtvQkFBRTNELElBQUk7b0JBQU00RCxhQUFheEcsS0FBS3FCLE1BQU07b0JBQUU0QjtvQkFBUUMsT0FBT29DLEdBQUdsRixJQUFJO2dCQUFDO1lBQ3ZFO1FBQ0YsR0FDQ3FHLEVBQUUsQ0FBQyxNQUFNbkIsR0FBR2YsRUFBRTtRQUVqQmMsUUFBUS9CLElBQUksQ0FBQztZQUNYaUIsSUFBSWUsR0FBR2YsRUFBRTtZQUNUckIsT0FBT29DLEdBQUdsRixJQUFJO1lBQ2Q2QztZQUNBeUQsUUFBUWQ7WUFDUmUsVUFBVTNHLEtBQUtxQixNQUFNO1lBQ3JCOEMsU0FBUyxDQUFDNEI7WUFDVnRDLE9BQU9zQyxNQUFNOUIsV0FBVztRQUMxQjtRQUVBLElBQUksQ0FBQzhCLE1BQU01QjtRQUNYLHNDQUFzQztRQUN0QyxNQUFNLElBQUlPLFFBQVEsQ0FBQ25DLElBQU1xRSxXQUFXckUsR0FBRztJQUN6QztJQUVBLE9BQU9wRixxREFBWUEsQ0FBQzRGLElBQUksQ0FBQztRQUFFSCxJQUFJO1FBQU11QjtRQUFTQyxXQUFXVCxRQUFRdEMsVUFBVTtRQUFHZ0U7SUFBUTtBQUN4RiIsInNvdXJjZXMiOlsid2VicGFjazovL3NvdW5kbWluZC8uL2FwcC9hcGkvZW5yaWNoL2xhc3RmbS9yb3V0ZS50cz8xZWI2Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGFwcC9hcGkvZW5yaWNoL2xhc3RmbS9yb3V0ZS50c1xuaW1wb3J0IHsgTmV4dFJlc3BvbnNlIH0gZnJvbSBcIm5leHQvc2VydmVyXCI7XG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlQWRtaW5cIjtcblxuLyoqXG4gKiBMQVNULkZNIEVOUklDSE1FTlRcbiAqIC0gTG9va3MgYXQgeW91ciBtb3N0IHJlY2VudCBsaXN0ZW5zIChsYXN0IDEwMCkgYW5kIGVucmljaGVzIHRoZWlyIHRyYWNrcyB3aXRoOlxuICogICAtIGdlbnJlX3ByaW1hcnkgICAoc3RyaW5nKVxuICogICAtIGdlbnJlX3RhZ3MgICAgICAoc3RyaW5nW10pXG4gKiAgIC0gZGVyaXZlZF9lbmVyZ3kgICgwLi4xKVxuICogICAtIGRlcml2ZWRfdmFsZW5jZSAoMC4uMSlcbiAqXG4gKiBXZSB1c2UgbGFzdC5mbSB0cmFjay5nZXRUb3BUYWdzICsgYXJ0aXN0LmdldFRvcFRhZ3MuXG4gKiBObyB1c2VyIGF1dGg6IHJlcXVpcmVzIExBU1RGTV9BUElfS0VZIGluIGVudi5cbiAqL1xuXG5jb25zdCBMQVNURk1fS0VZID0gcHJvY2Vzcy5lbnYuTEFTVEZNX0FQSV9LRVk7XG5cbi8vIEJhc2ljIHRhZyBub3JtYWxpemF0aW9uL2FsaWFzZXNcbmNvbnN0IFRBR19BTElBUzogUmVjb3JkPHN0cmluZywgc3RyaW5nPiA9IHtcbiAgXCJoaXAgaG9wXCI6IFwiaGlwLWhvcFwiLFxuICBoaXBob3A6IFwiaGlwLWhvcFwiLFxuICBcImxvIGZpXCI6IFwibG8tZmlcIixcbiAgbG9maTogXCJsby1maVwiLFxuICBlZG06IFwiZWRtXCIsXG4gIGRuYjogXCJkcnVtLWFuZC1iYXNzXCIsXG4gIFwiZHJ1bSBuIGJhc3NcIjogXCJkcnVtLWFuZC1iYXNzXCIsXG4gIFwiZHJ1bSAmIGJhc3NcIjogXCJkcnVtLWFuZC1iYXNzXCIsXG4gIGhvdXNlOiBcImhvdXNlXCIsXG4gIHRlY2hubzogXCJ0ZWNobm9cIixcbiAgdHJhbmNlOiBcInRyYW5jZVwiLFxuICBhbWJpZW50OiBcImFtYmllbnRcIixcbiAgY2hpbGw6IFwiY2hpbGxcIixcbiAgXCJjaGlsbCBvdXRcIjogXCJjaGlsbFwiLFxuICByb2NrOiBcInJvY2tcIixcbiAgbWV0YWw6IFwibWV0YWxcIixcbiAgcG9wOiBcInBvcFwiLFxuICB0cmFwOiBcInRyYXBcIixcbiAgZGFuY2U6IFwiZGFuY2VcIixcbiAgXCJyJmJcIjogXCJybmJcIixcbiAgcm5iOiBcInJuYlwiLFxufTtcblxuLy8gSGV1cmlzdGljIG1hcHMgZm9yIGRlcml2aW5nIGVuZXJneS92YWxlbmNlIGZyb20gdGFncy5cbi8vIE5PVEU6IGtleXMgd2l0aCBoeXBoZW5zIE1VU1QgYmUgcXVvdGVkIGluIFRTLlxuY29uc3QgVEFHX1RPX0VORVJHWTogUmVjb3JkPHN0cmluZywgbnVtYmVyPiA9IHtcbiAgcmF2ZTogMC45LFxuICBoYXJkc3R5bGU6IDAuOTUsXG4gIGVkbTogMC44LFxuICBkYW5jZTogMC43LFxuICByb2NrOiAwLjcsXG4gIHRlY2hubzogMC44LFxuICBob3VzZTogMC43LFxuICBjaGlsbDogMC4yLFxuICBhbWJpZW50OiAwLjEsXG4gIGFjb3VzdGljOiAwLjIsXG4gIGRvd250ZW1wbzogMC4zLFxuICBcImxvLWZpXCI6IDAuMjUsXG4gIGxvZmk6IDAuMjUsXG4gIHBvcDogMC42LFxuICBoaXBob3A6IDAuNixcbiAgXCJoaXAtaG9wXCI6IDAuNixcbiAgdHJhcDogMC43LFxuICBtZXRhbDogMC44NSxcbiAgdHJhbmNlOiAwLjc1LFxuICBcImRydW0tYW5kLWJhc3NcIjogMC44NSxcbn07XG5cbmNvbnN0IFRBR19UT19WQUxFTkNFOiBSZWNvcmQ8c3RyaW5nLCBudW1iZXI+ID0ge1xuICBoYXBweTogMC45LFxuICB1cGJlYXQ6IDAuOCxcbiAgdXBsaWZ0aW5nOiAwLjgsXG4gIG1lbGFuY2hvbGljOiAwLjIsXG4gIHNhZDogMC4xLFxuICBkYXJrOiAwLjIsXG4gIGNoaWxsOiAwLjYsXG4gIGFtYmllbnQ6IDAuNSxcbiAgYWNvdXN0aWM6IDAuNyxcbiAgcG9wOiAwLjcsXG4gIFwiaGlwLWhvcFwiOiAwLjYsXG4gIGhpcGhvcDogMC42LFxuICB0cmFwOiAwLjUsXG4gIHRlY2hubzogMC40LFxuICBtZXRhbDogMC4zLFxuICB0cmFuY2U6IDAuNixcbn07XG5cbi8vIFVzZWZ1bCBzdG9wd29yZHMgd2UgZG9u4oCZdCB3YW50IGFzIOKAnGdlbnJlc+KAnVxuY29uc3QgVEFHX1NUT1AgPSBuZXcgU2V0KFtcbiAgXCJzZWVuIGxpdmVcIixcbiAgXCJmYXZvcml0ZXNcIixcbiAgXCJmYXZvcml0ZVwiLFxuICBcImF3ZXNvbWVcIixcbiAgXCI5MHNcIixcbiAgXCIwMHNcIixcbiAgXCIyMDEwc1wiLFxuICBcIjIwMjBzXCIsXG4gIFwidWtcIixcbiAgXCJ1c2FcIixcbiAgXCJicml0aXNoXCIsXG4gIFwic3dlZGlzaFwiLFxuICBcImdlcm1hblwiLFxuICBcImZlbWFsZSB2b2NhbGlzdHNcIixcbiAgXCJtYWxlIHZvY2FsaXN0c1wiLFxuXSk7XG5cbnR5cGUgTGFzdGZtVGFnID0geyBuYW1lOiBzdHJpbmc7IGNvdW50PzogbnVtYmVyIH07XG5cbmZ1bmN0aW9uIG5vcm1hbGl6ZVRhZyh0OiBzdHJpbmcpOiBzdHJpbmcge1xuICBjb25zdCBzID0gdC50cmltKCkudG9Mb3dlckNhc2UoKTtcbiAgY29uc3QgY2xlYW4gPSBzLnJlcGxhY2UoL1xccysvZywgXCIgXCIpOyAvLyBjb2xsYXBzZSBzcGFjZXNcbiAgY29uc3QgYWxpYXMgPSBUQUdfQUxJQVNbY2xlYW5dIHx8IGNsZWFuO1xuICAvLyBzdHJpcCBub24td29yZCBjaGFyYWN0ZXJzIGV4Y2VwdCBzcGFjZSBhbmQgaHlwaGVuXG4gIHJldHVybiBhbGlhcy5yZXBsYWNlKC9bXlxcd1xccy1dL2csIFwiXCIpLnRyaW0oKTtcbn1cblxuZnVuY3Rpb24gc2NvcmVUYWdzKHRhZ3M6IExhc3RmbVRhZ1tdKSB7XG4gIC8vIFJldHVybiBjbGVhbmVkLCB3ZWlnaHRlZCB0YWcgbGlzdCBhbmQgdG9wIGNhbmRpZGF0ZXMgZm9yIGdlbnJlX3ByaW1hcnlcbiAgY29uc3QgbWFwID0gbmV3IE1hcDxzdHJpbmcsIG51bWJlcj4oKTtcbiAgZm9yIChjb25zdCB0YWcgb2YgdGFncyB8fCBbXSkge1xuICAgIGlmICghdGFnPy5uYW1lKSBjb250aW51ZTtcbiAgICBsZXQgbiA9IG5vcm1hbGl6ZVRhZyh0YWcubmFtZSk7XG4gICAgaWYgKCFuIHx8IFRBR19TVE9QLmhhcyhuKSkgY29udGludWU7XG4gICAgY29uc3QgdyA9IE1hdGgubWF4KDEsIE51bWJlcih0YWcuY291bnQgfHwgMSkpO1xuICAgIG1hcC5zZXQobiwgKG1hcC5nZXQobikgfHwgMCkgKyB3KTtcbiAgfVxuICAvLyBzb3J0IGJ5IHdlaWdodCBkZXNjXG4gIGNvbnN0IGVudHJpZXMgPSBbLi4ubWFwLmVudHJpZXMoKV0uc29ydCgoYSwgYikgPT4gYlsxXSAtIGFbMV0pO1xuICBjb25zdCBvcmRlcmVkID0gZW50cmllcy5tYXAoKFtrXSkgPT4gayk7XG4gIGNvbnN0IHRvcCA9IGVudHJpZXMubGVuZ3RoID4gMCA/IGVudHJpZXNbMF1bMF0gOiBudWxsO1xuICByZXR1cm4geyBvcmRlcmVkLCB0b3AgfTtcbn1cblxuZnVuY3Rpb24gZGVyaXZlRW5lcmd5VmFsZW5jZSh0YWdzOiBzdHJpbmdbXSkge1xuICBpZiAoIXRhZ3M/Lmxlbmd0aCkgcmV0dXJuIHsgZW5lcmd5OiBudWxsIGFzIG51bWJlciB8IG51bGwsIHZhbGVuY2U6IG51bGwgYXMgbnVtYmVyIHwgbnVsbCB9O1xuICBsZXQgZVN1bSA9IDAsXG4gICAgZU4gPSAwLFxuICAgIHZTdW0gPSAwLFxuICAgIHZOID0gMDtcbiAgZm9yIChjb25zdCB0IG9mIHRhZ3MpIHtcbiAgICBpZiAodCBpbiBUQUdfVE9fRU5FUkdZKSB7XG4gICAgICBlU3VtICs9IFRBR19UT19FTkVSR1lbdF07XG4gICAgICBlTisrO1xuICAgIH1cbiAgICBpZiAodCBpbiBUQUdfVE9fVkFMRU5DRSkge1xuICAgICAgdlN1bSArPSBUQUdfVE9fVkFMRU5DRVt0XTtcbiAgICAgIHZOKys7XG4gICAgfVxuICB9XG4gIHJldHVybiB7XG4gICAgZW5lcmd5OiBlTiA/IE51bWJlcigoZVN1bSAvIGVOKS50b0ZpeGVkKDMpKSA6IG51bGwsXG4gICAgdmFsZW5jZTogdk4gPyBOdW1iZXIoKHZTdW0gLyB2TikudG9GaXhlZCgzKSkgOiBudWxsLFxuICB9O1xufVxuXG5hc3luYyBmdW5jdGlvbiBsZihtZXRob2Q6IHN0cmluZywgcGFyYW1zOiBSZWNvcmQ8c3RyaW5nLCBzdHJpbmc+KSB7XG4gIGNvbnN0IHVybCA9IG5ldyBVUkwoXCJodHRwczovL3dzLmF1ZGlvc2Nyb2JibGVyLmNvbS8yLjAvXCIpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcIm1ldGhvZFwiLCBtZXRob2QpO1xuICB1cmwuc2VhcmNoUGFyYW1zLnNldChcImFwaV9rZXlcIiwgU3RyaW5nKExBU1RGTV9LRVkpKTtcbiAgdXJsLnNlYXJjaFBhcmFtcy5zZXQoXCJmb3JtYXRcIiwgXCJqc29uXCIpO1xuICBmb3IgKGNvbnN0IFtrLCB2XSBvZiBPYmplY3QuZW50cmllcyhwYXJhbXMpKSB1cmwuc2VhcmNoUGFyYW1zLnNldChrLCB2KTtcbiAgY29uc3QgciA9IGF3YWl0IGZldGNoKHVybC50b1N0cmluZygpLCB7IG5leHQ6IHsgcmV2YWxpZGF0ZTogMCB9IH0pO1xuICBpZiAoIXIub2spIHRocm93IG5ldyBFcnJvcihgTGFzdC5mbSAke21ldGhvZH0gJHtyLnN0YXR1c31gKTtcbiAgcmV0dXJuIHIuanNvbigpO1xufVxuXG5hc3luYyBmdW5jdGlvbiBmZXRjaFRhZ3NGb3IoYXJ0aXN0OiBzdHJpbmcsIHRyYWNrOiBzdHJpbmcpOiBQcm9taXNlPExhc3RmbVRhZ1tdPiB7XG4gIGNvbnN0IHRhZ3M6IExhc3RmbVRhZ1tdID0gW107XG4gIHRyeSB7XG4gICAgY29uc3QganQgPSBhd2FpdCBsZihcInRyYWNrLmdldFRvcFRhZ3NcIiwge1xuICAgICAgYXJ0aXN0LFxuICAgICAgdHJhY2ssXG4gICAgICBhdXRvY29ycmVjdDogXCIxXCIsXG4gICAgfSk7XG4gICAgaWYgKGp0Py50b3B0YWdzPy50YWc/Lmxlbmd0aCkgdGFncy5wdXNoKC4uLmp0LnRvcHRhZ3MudGFnKTtcbiAgfSBjYXRjaCB7XG4gICAgLy8gaWdub3JlXG4gIH1cbiAgLy8gSWYgbm90aGluZyBmcm9tIHRyYWNrLCB0cnkgYXJ0aXN0XG4gIGlmICh0YWdzLmxlbmd0aCA9PT0gMCkge1xuICAgIHRyeSB7XG4gICAgICBjb25zdCBqYSA9IGF3YWl0IGxmKFwiYXJ0aXN0LmdldFRvcFRhZ3NcIiwgeyBhcnRpc3QsIGF1dG9jb3JyZWN0OiBcIjFcIiB9KTtcbiAgICAgIGlmIChqYT8udG9wdGFncz8udGFnPy5sZW5ndGgpIHRhZ3MucHVzaCguLi5qYS50b3B0YWdzLnRhZyk7XG4gICAgfSBjYXRjaCB7XG4gICAgICAvLyBpZ25vcmVcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHRhZ3M7XG59XG5cbnR5cGUgVHJhY2tSb3cgPSB7XG4gIGlkOiBzdHJpbmc7XG4gIG5hbWU6IHN0cmluZztcbiAgZ2VucmVfcHJpbWFyeT86IHN0cmluZyB8IG51bGw7XG4gIGdlbnJlX3RhZ3M/OiBzdHJpbmdbXSB8IG51bGw7XG4gIGFydGlzdF9uYW1lPzogc3RyaW5nIHwgbnVsbDtcbn07XG5cbnR5cGUgTGlua1JvdyA9IHsgdHJhY2tfaWQ6IHN0cmluZzsgYXJ0aXN0X2lkOiBzdHJpbmcgfTtcbnR5cGUgQXJ0aXN0Um93ID0geyBpZDogc3RyaW5nOyBuYW1lOiBzdHJpbmcgfTtcblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QoKSB7XG4gIGlmICghTEFTVEZNX0tFWSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbihcbiAgICAgIHsgb2s6IGZhbHNlLCBlcnJvcjogXCJNaXNzaW5nIExBU1RGTV9BUElfS0VZXCIgfSxcbiAgICAgIHsgc3RhdHVzOiA1MDAgfVxuICAgICk7XG4gIH1cblxuICAvLyAxKSBGaW5kIHVwIHRvIDEwMCB0cmFja3MgdGhhdCBsYWNrIGdlbnJlIG1ldGFkYXRhXG4gIGNvbnN0IHsgZGF0YTogdHJhY2tzLCBlcnJvcjogdEVyciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgIC5mcm9tKFwic3BvdGlmeV90cmFja3NcIilcbiAgICAuc2VsZWN0KFwiaWQsbmFtZSxnZW5yZV9wcmltYXJ5LGdlbnJlX3RhZ3MsYXJ0aXN0X25hbWVcIilcbiAgICAub3IoXCJnZW5yZV9wcmltYXJ5LmlzLm51bGwsZ2VucmVfdGFncy5pcy5udWxsXCIpXG4gICAgLmxpbWl0KDEwMCk7XG4gIGlmICh0RXJyKSByZXR1cm4gTmV4dFJlc3BvbnNlLmpzb24oeyBvazogZmFsc2UsIGVycm9yOiB0RXJyLm1lc3NhZ2UgfSwgeyBzdGF0dXM6IDUwMCB9KTtcbiAgY29uc3QgdHJhY2tSb3dzID0gdHJhY2tzIGFzIFRyYWNrUm93W10gfCBudWxsO1xuICBpZiAoIXRyYWNrUm93cz8ubGVuZ3RoKVxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiB0cnVlLCB1cGRhdGVkOiAwLCBwcm9jZXNzZWQ6IDAsIG5vdGU6IFwiTm8gdHJhY2tzIG5lZWQgdGFnc1wiIH0pO1xuXG4gIGNvbnN0IGlkcyA9IHRyYWNrUm93cy5tYXAoKHQpID0+IHQuaWQpO1xuXG4gIC8vIDIpIEZldGNoIHRyYWNrLWFydGlzdCBsaW5rcyBhbmQgYXJ0aXN0IG5hbWVzXG4gIGNvbnN0IFt7IGRhdGE6IGxpbmtzIH0sIHsgZGF0YTogYXJ0aXN0cyB9XSA9IGF3YWl0IFByb21pc2UuYWxsKFtcbiAgICBzdXBhYmFzZUFkbWluLmZyb20oXCJzcG90aWZ5X3RyYWNrX2FydGlzdHNcIikuc2VsZWN0KFwidHJhY2tfaWQsYXJ0aXN0X2lkXCIpLmluKFwidHJhY2tfaWRcIiwgaWRzKSxcbiAgICBzdXBhYmFzZUFkbWluLmZyb20oXCJzcG90aWZ5X2FydGlzdHNcIikuc2VsZWN0KFwiaWQsbmFtZVwiKSxcbiAgXSBhcyBjb25zdCk7XG5cbiAgY29uc3QgYXJ0aXN0TWFwID0gbmV3IE1hcDxzdHJpbmcsIHN0cmluZz4oKTtcbiAgKGFydGlzdHMgYXMgQXJ0aXN0Um93W10gfCBudWxsIHwgdW5kZWZpbmVkKT8uZm9yRWFjaCgoYSkgPT4gYXJ0aXN0TWFwLnNldChhLmlkLCBhLm5hbWUpKTtcblxuICBjb25zdCB0cmFja0FydGlzdHMgPSBuZXcgTWFwPHN0cmluZywgc3RyaW5nW10+KCk7XG4gIChsaW5rcyBhcyBMaW5rUm93W10gfCBudWxsIHwgdW5kZWZpbmVkKT8uZm9yRWFjaCgobG5rKSA9PiB7XG4gICAgY29uc3QgYXJyID0gdHJhY2tBcnRpc3RzLmdldChsbmsudHJhY2tfaWQpIHx8IFtdO1xuICAgIGNvbnN0IG5tID0gYXJ0aXN0TWFwLmdldChsbmsuYXJ0aXN0X2lkKTtcbiAgICBpZiAobm0pIGFyci5wdXNoKG5tKTtcbiAgICB0cmFja0FydGlzdHMuc2V0KGxuay50cmFja19pZCwgYXJyKTtcbiAgfSk7XG5cbiAgLy8gMykgRm9yIGVhY2ggdHJhY2ssIGNhbGwgbGFzdC5mbSBhbmQgdXBkYXRlIHRoZSByb3dcbiAgbGV0IHVwZGF0ZWQgPSAwO1xuICBjb25zdCByZXN1bHRzOiBhbnlbXSA9IFtdO1xuXG4gIGZvciAoY29uc3QgdHIgb2YgdHJhY2tSb3dzKSB7XG4gICAgbGV0IGFydGlzdHNGb3JUcmFjayA9IHRyYWNrQXJ0aXN0cy5nZXQodHIuaWQpIHx8IFtdO1xuICAgIGlmICgoIWFydGlzdHNGb3JUcmFjayB8fCBhcnRpc3RzRm9yVHJhY2subGVuZ3RoID09PSAwKSAmJiB0ci5hcnRpc3RfbmFtZSkge1xuICAgICAgYXJ0aXN0c0ZvclRyYWNrID0gU3RyaW5nKHRyLmFydGlzdF9uYW1lKVxuICAgICAgICAuc3BsaXQoXCIsXCIpXG4gICAgICAgIC5tYXAoKHMpID0+IHMudHJpbSgpKVxuICAgICAgICAuZmlsdGVyKEJvb2xlYW4pO1xuICAgIH1cbiAgICBjb25zdCBhcnRpc3QgPSBhcnRpc3RzRm9yVHJhY2tbMF0gfHwgXCJcIjsgLy8gcGljayB0aGUgZmlyc3QgKHByaW1hcnkpIGFydGlzdFxuICAgIGlmICghYXJ0aXN0IHx8ICF0ci5uYW1lKSBjb250aW51ZTtcblxuICAgIGNvbnN0IHRhZ3MgPSBhd2FpdCBmZXRjaFRhZ3NGb3IoYXJ0aXN0LCB0ci5uYW1lKTtcbiAgICBjb25zdCB7IG9yZGVyZWQsIHRvcCB9ID0gc2NvcmVUYWdzKHRhZ3MpO1xuICAgIGNvbnN0IHsgZW5lcmd5LCB2YWxlbmNlIH0gPSBkZXJpdmVFbmVyZ3lWYWxlbmNlKG9yZGVyZWQpO1xuXG4gICAgY29uc3QgZ2VucmVfcHJpbWFyeSA9IHRvcCB8fCB0ci5nZW5yZV9wcmltYXJ5IHx8IG51bGw7XG4gICAgY29uc3QgZ2VucmVfdGFncyA9IG9yZGVyZWQuc2xpY2UoMCwgOCk7XG5cbiAgICBjb25zdCB7IGVycm9yOiB1RXJyIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbShcInNwb3RpZnlfdHJhY2tzXCIpXG4gICAgICAudXBkYXRlKHtcbiAgICAgICAgZ2VucmVfcHJpbWFyeSxcbiAgICAgICAgZ2VucmVfdGFnczogZ2VucmVfdGFncy5sZW5ndGggPyBnZW5yZV90YWdzIDogbnVsbCxcbiAgICAgICAgZGVyaXZlZF9lbmVyZ3k6IGVuZXJneSxcbiAgICAgICAgZGVyaXZlZF92YWxlbmNlOiB2YWxlbmNlLFxuICAgICAgICBsYXN0X2VucmljaGVkX2F0OiBuZXcgRGF0ZSgpLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIG1ldGFfcHJvdmlkZXI6IHtcbiAgICAgICAgICAuLi4odHlwZW9mICh0ciBhcyBhbnkpLm1ldGFfcHJvdmlkZXIgPT09IFwib2JqZWN0XCIgPyAodHIgYXMgYW55KS5tZXRhX3Byb3ZpZGVyIDoge30pLFxuICAgICAgICAgIGxhc3RmbTogeyBvazogdHJ1ZSwgdGFnc0ZldGNoZWQ6IHRhZ3MubGVuZ3RoLCBhcnRpc3QsIHRyYWNrOiB0ci5uYW1lIH0sXG4gICAgICAgIH0sXG4gICAgICB9KVxuICAgICAgLmVxKFwiaWRcIiwgdHIuaWQpO1xuXG4gICAgcmVzdWx0cy5wdXNoKHtcbiAgICAgIGlkOiB0ci5pZCxcbiAgICAgIHRyYWNrOiB0ci5uYW1lLFxuICAgICAgYXJ0aXN0LFxuICAgICAgdG9wVGFnOiBnZW5yZV9wcmltYXJ5LFxuICAgICAgdGFnQ291bnQ6IHRhZ3MubGVuZ3RoLFxuICAgICAgdXBkYXRlZDogIXVFcnIsXG4gICAgICBlcnJvcjogdUVycj8ubWVzc2FnZSB8fCBudWxsLFxuICAgIH0pO1xuXG4gICAgaWYgKCF1RXJyKSB1cGRhdGVkKys7XG4gICAgLy8gU21hbGwgZGVsYXkgdG8gYmUgcG9saXRlIHRvIExhc3QuZm1cbiAgICBhd2FpdCBuZXcgUHJvbWlzZSgocikgPT4gc2V0VGltZW91dChyLCAxMjApKTtcbiAgfVxuXG4gIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiB0cnVlLCB1cGRhdGVkLCBwcm9jZXNzZWQ6IHRyYWNrcz8ubGVuZ3RoIHx8IDAsIHJlc3VsdHMgfSk7XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwic3VwYWJhc2VBZG1pbiIsIkxBU1RGTV9LRVkiLCJwcm9jZXNzIiwiZW52IiwiTEFTVEZNX0FQSV9LRVkiLCJUQUdfQUxJQVMiLCJoaXBob3AiLCJsb2ZpIiwiZWRtIiwiZG5iIiwiaG91c2UiLCJ0ZWNobm8iLCJ0cmFuY2UiLCJhbWJpZW50IiwiY2hpbGwiLCJyb2NrIiwibWV0YWwiLCJwb3AiLCJ0cmFwIiwiZGFuY2UiLCJybmIiLCJUQUdfVE9fRU5FUkdZIiwicmF2ZSIsImhhcmRzdHlsZSIsImFjb3VzdGljIiwiZG93bnRlbXBvIiwiVEFHX1RPX1ZBTEVOQ0UiLCJoYXBweSIsInVwYmVhdCIsInVwbGlmdGluZyIsIm1lbGFuY2hvbGljIiwic2FkIiwiZGFyayIsIlRBR19TVE9QIiwiU2V0Iiwibm9ybWFsaXplVGFnIiwidCIsInMiLCJ0cmltIiwidG9Mb3dlckNhc2UiLCJjbGVhbiIsInJlcGxhY2UiLCJhbGlhcyIsInNjb3JlVGFncyIsInRhZ3MiLCJtYXAiLCJNYXAiLCJ0YWciLCJuYW1lIiwibiIsImhhcyIsInciLCJNYXRoIiwibWF4IiwiTnVtYmVyIiwiY291bnQiLCJzZXQiLCJnZXQiLCJlbnRyaWVzIiwic29ydCIsImEiLCJiIiwib3JkZXJlZCIsImsiLCJ0b3AiLCJsZW5ndGgiLCJkZXJpdmVFbmVyZ3lWYWxlbmNlIiwiZW5lcmd5IiwidmFsZW5jZSIsImVTdW0iLCJlTiIsInZTdW0iLCJ2TiIsInRvRml4ZWQiLCJsZiIsIm1ldGhvZCIsInBhcmFtcyIsInVybCIsIlVSTCIsInNlYXJjaFBhcmFtcyIsIlN0cmluZyIsInYiLCJPYmplY3QiLCJyIiwiZmV0Y2giLCJ0b1N0cmluZyIsIm5leHQiLCJyZXZhbGlkYXRlIiwib2siLCJFcnJvciIsInN0YXR1cyIsImpzb24iLCJmZXRjaFRhZ3NGb3IiLCJhcnRpc3QiLCJ0cmFjayIsImp0IiwiYXV0b2NvcnJlY3QiLCJ0b3B0YWdzIiwicHVzaCIsImphIiwiUE9TVCIsImVycm9yIiwiZGF0YSIsInRyYWNrcyIsInRFcnIiLCJmcm9tIiwic2VsZWN0Iiwib3IiLCJsaW1pdCIsIm1lc3NhZ2UiLCJ0cmFja1Jvd3MiLCJ1cGRhdGVkIiwicHJvY2Vzc2VkIiwibm90ZSIsImlkcyIsImlkIiwibGlua3MiLCJhcnRpc3RzIiwiUHJvbWlzZSIsImFsbCIsImluIiwiYXJ0aXN0TWFwIiwiZm9yRWFjaCIsInRyYWNrQXJ0aXN0cyIsImxuayIsImFyciIsInRyYWNrX2lkIiwibm0iLCJhcnRpc3RfaWQiLCJyZXN1bHRzIiwidHIiLCJhcnRpc3RzRm9yVHJhY2siLCJhcnRpc3RfbmFtZSIsInNwbGl0IiwiZmlsdGVyIiwiQm9vbGVhbiIsImdlbnJlX3ByaW1hcnkiLCJnZW5yZV90YWdzIiwic2xpY2UiLCJ1RXJyIiwidXBkYXRlIiwiZGVyaXZlZF9lbmVyZ3kiLCJkZXJpdmVkX3ZhbGVuY2UiLCJsYXN0X2VucmljaGVkX2F0IiwiRGF0ZSIsInRvSVNPU3RyaW5nIiwibWV0YV9wcm92aWRlciIsImxhc3RmbSIsInRhZ3NGZXRjaGVkIiwiZXEiLCJ0b3BUYWciLCJ0YWdDb3VudCIsInNldFRpbWVvdXQiXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./app/api/enrich/lastfm/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabaseAdmin.ts":
/*!******************************!*\
  !*** ./lib/supabaseAdmin.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin),\n/* harmony export */   supabaseService: () => (/* binding */ supabaseService),\n/* harmony export */   usingServiceRole: () => (/* binding */ usingServiceRole)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// lib/supabaseAdmin.ts\n\nconst url = \"https://awxeorfppxdsygnhxlth.supabase.co\";\nconst serviceKey = process.env.SUPABASE_SERVICE_ROLE_KEY;\n// Expose whether the service role key is configured so API routes can bail early\nconst usingServiceRole = !!(url && serviceKey);\n// Lazily create a Supabase client that uses the service role key.  This should\n// only be used in server-side code as it has full access to the database.\nfunction supabaseService() {\n    if (!usingServiceRole) {\n        throw new Error(\"SUPABASE_SERVICE_ROLE_KEY is not set\");\n    }\n    return (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(url, serviceKey, {\n        auth: {\n            persistSession: false,\n            autoRefreshToken: false\n        }\n    });\n}\n// Convenience singleton for callers that just need a client instance.\nconst supabaseAdmin = usingServiceRole ? supabaseService() : null;\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2VBZG1pbi50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7O0FBQUEsdUJBQXVCO0FBQzhCO0FBRXJELE1BQU1DLE1BQU1DLDBDQUFvQztBQUNoRCxNQUFNRyxhQUFhSCxRQUFRQyxHQUFHLENBQUNHLHlCQUF5QjtBQUV4RCxpRkFBaUY7QUFDMUUsTUFBTUMsbUJBQW1CLENBQUMsQ0FBRU4sQ0FBQUEsT0FBT0ksVUFBUyxFQUFHO0FBRXRELCtFQUErRTtBQUMvRSwwRUFBMEU7QUFDbkUsU0FBU0c7SUFDZCxJQUFJLENBQUNELGtCQUFrQjtRQUNyQixNQUFNLElBQUlFLE1BQU07SUFDbEI7SUFDQSxPQUFPVCxtRUFBWUEsQ0FBQ0MsS0FBTUksWUFBYTtRQUNyQ0ssTUFBTTtZQUFFQyxnQkFBZ0I7WUFBT0Msa0JBQWtCO1FBQU07SUFDekQ7QUFDRjtBQUVBLHNFQUFzRTtBQUMvRCxNQUFNQyxnQkFBZ0JOLG1CQUFtQkMsb0JBQXFCLEtBQWEiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zb3VuZG1pbmQvLi9saWIvc3VwYWJhc2VBZG1pbi50cz8wOWQ1Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGxpYi9zdXBhYmFzZUFkbWluLnRzXG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XG5cbmNvbnN0IHVybCA9IHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTDtcbmNvbnN0IHNlcnZpY2VLZXkgPSBwcm9jZXNzLmVudi5TVVBBQkFTRV9TRVJWSUNFX1JPTEVfS0VZO1xuXG4vLyBFeHBvc2Ugd2hldGhlciB0aGUgc2VydmljZSByb2xlIGtleSBpcyBjb25maWd1cmVkIHNvIEFQSSByb3V0ZXMgY2FuIGJhaWwgZWFybHlcbmV4cG9ydCBjb25zdCB1c2luZ1NlcnZpY2VSb2xlID0gISEodXJsICYmIHNlcnZpY2VLZXkpO1xuXG4vLyBMYXppbHkgY3JlYXRlIGEgU3VwYWJhc2UgY2xpZW50IHRoYXQgdXNlcyB0aGUgc2VydmljZSByb2xlIGtleS4gIFRoaXMgc2hvdWxkXG4vLyBvbmx5IGJlIHVzZWQgaW4gc2VydmVyLXNpZGUgY29kZSBhcyBpdCBoYXMgZnVsbCBhY2Nlc3MgdG8gdGhlIGRhdGFiYXNlLlxuZXhwb3J0IGZ1bmN0aW9uIHN1cGFiYXNlU2VydmljZSgpIHtcbiAgaWYgKCF1c2luZ1NlcnZpY2VSb2xlKSB7XG4gICAgdGhyb3cgbmV3IEVycm9yKFwiU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSBpcyBub3Qgc2V0XCIpO1xuICB9XG4gIHJldHVybiBjcmVhdGVDbGllbnQodXJsISwgc2VydmljZUtleSEsIHtcbiAgICBhdXRoOiB7IHBlcnNpc3RTZXNzaW9uOiBmYWxzZSwgYXV0b1JlZnJlc2hUb2tlbjogZmFsc2UgfSxcbiAgfSk7XG59XG5cbi8vIENvbnZlbmllbmNlIHNpbmdsZXRvbiBmb3IgY2FsbGVycyB0aGF0IGp1c3QgbmVlZCBhIGNsaWVudCBpbnN0YW5jZS5cbmV4cG9ydCBjb25zdCBzdXBhYmFzZUFkbWluID0gdXNpbmdTZXJ2aWNlUm9sZSA/IHN1cGFiYXNlU2VydmljZSgpIDogKG51bGwgYXMgYW55KTtcbiJdLCJuYW1lcyI6WyJjcmVhdGVDbGllbnQiLCJ1cmwiLCJwcm9jZXNzIiwiZW52IiwiTkVYVF9QVUJMSUNfU1VQQUJBU0VfVVJMIiwic2VydmljZUtleSIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJ1c2luZ1NlcnZpY2VSb2xlIiwic3VwYWJhc2VTZXJ2aWNlIiwiRXJyb3IiLCJhdXRoIiwicGVyc2lzdFNlc3Npb24iLCJhdXRvUmVmcmVzaFRva2VuIiwic3VwYWJhc2VBZG1pbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabaseAdmin.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fenrich%2Flastfm%2Froute&page=%2Fapi%2Fenrich%2Flastfm%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fenrich%2Flastfm%2Froute.ts&appDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();