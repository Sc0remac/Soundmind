"use strict";
/*
 * ATTENTION: An "eval-source-map" devtool has been used.
 * This devtool is neither made for production nor for readable output files.
 * It uses "eval()" calls to create a separate source file with attached SourceMaps in the browser devtools.
 * If you are trying to read the output file, select a different devtool (https://webpack.js.org/configuration/devtool/)
 * or disable the default devtool with "devtool: false".
 * If you are looking for production-ready output files, see mode: "production" (https://webpack.js.org/configuration/mode/).
 */
(() => {
var exports = {};
exports.id = "app/api/spotify/my/sync/route";
exports.ids = ["app/api/spotify/my/sync/route"];
exports.modules = {

/***/ "../../client/components/action-async-storage.external":
/*!*******************************************************************************!*\
  !*** external "next/dist/client/components/action-async-storage.external.js" ***!
  \*******************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/action-async-storage.external.js");

/***/ }),

/***/ "../../client/components/request-async-storage.external":
/*!********************************************************************************!*\
  !*** external "next/dist/client/components/request-async-storage.external.js" ***!
  \********************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/request-async-storage.external.js");

/***/ }),

/***/ "../../client/components/static-generation-async-storage.external":
/*!******************************************************************************************!*\
  !*** external "next/dist/client/components/static-generation-async-storage.external.js" ***!
  \******************************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/client/components/static-generation-async-storage.external.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-page.runtime.dev.js":
/*!*************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-page.runtime.dev.js" ***!
  \*************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-page.runtime.dev.js");

/***/ }),

/***/ "next/dist/compiled/next-server/app-route.runtime.dev.js":
/*!**************************************************************************!*\
  !*** external "next/dist/compiled/next-server/app-route.runtime.dev.js" ***!
  \**************************************************************************/
/***/ ((module) => {

module.exports = require("next/dist/compiled/next-server/app-route.runtime.dev.js");

/***/ }),

/***/ "http":
/*!***********************!*\
  !*** external "http" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("http");

/***/ }),

/***/ "https":
/*!************************!*\
  !*** external "https" ***!
  \************************/
/***/ ((module) => {

module.exports = require("https");

/***/ }),

/***/ "punycode":
/*!***************************!*\
  !*** external "punycode" ***!
  \***************************/
/***/ ((module) => {

module.exports = require("punycode");

/***/ }),

/***/ "stream":
/*!*************************!*\
  !*** external "stream" ***!
  \*************************/
/***/ ((module) => {

module.exports = require("stream");

/***/ }),

/***/ "url":
/*!**********************!*\
  !*** external "url" ***!
  \**********************/
/***/ ((module) => {

module.exports = require("url");

/***/ }),

/***/ "zlib":
/*!***********************!*\
  !*** external "zlib" ***!
  \***********************/
/***/ ((module) => {

module.exports = require("zlib");

/***/ }),

/***/ "(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute&page=%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute.ts&appDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!":
/*!***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************!*\
  !*** ./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute&page=%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute.ts&appDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D! ***!
  \***************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   originalPathname: () => (/* binding */ originalPathname),\n/* harmony export */   patchFetch: () => (/* binding */ patchFetch),\n/* harmony export */   requestAsyncStorage: () => (/* binding */ requestAsyncStorage),\n/* harmony export */   routeModule: () => (/* binding */ routeModule),\n/* harmony export */   serverHooks: () => (/* binding */ serverHooks),\n/* harmony export */   staticGenerationAsyncStorage: () => (/* binding */ staticGenerationAsyncStorage)\n/* harmony export */ });\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/dist/server/future/route-modules/app-route/module.compiled */ \"(rsc)/./node_modules/next/dist/server/future/route-modules/app-route/module.compiled.js\");\n/* harmony import */ var next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__);\n/* harmony import */ var next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/dist/server/future/route-kind */ \"(rsc)/./node_modules/next/dist/server/future/route-kind.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! next/dist/server/lib/patch-fetch */ \"(rsc)/./node_modules/next/dist/server/lib/patch-fetch.js\");\n/* harmony import */ var next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2___default = /*#__PURE__*/__webpack_require__.n(next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__);\n/* harmony import */ var _Users_cormackerr_Desktop_soundmind_app_api_spotify_my_sync_route_ts__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! ./app/api/spotify/my/sync/route.ts */ \"(rsc)/./app/api/spotify/my/sync/route.ts\");\n\n\n\n\n// We inject the nextConfigOutput here so that we can use them in the route\n// module.\nconst nextConfigOutput = \"\"\nconst routeModule = new next_dist_server_future_route_modules_app_route_module_compiled__WEBPACK_IMPORTED_MODULE_0__.AppRouteRouteModule({\n    definition: {\n        kind: next_dist_server_future_route_kind__WEBPACK_IMPORTED_MODULE_1__.RouteKind.APP_ROUTE,\n        page: \"/api/spotify/my/sync/route\",\n        pathname: \"/api/spotify/my/sync\",\n        filename: \"route\",\n        bundlePath: \"app/api/spotify/my/sync/route\"\n    },\n    resolvedPagePath: \"/Users/cormackerr/Desktop/soundmind/app/api/spotify/my/sync/route.ts\",\n    nextConfigOutput,\n    userland: _Users_cormackerr_Desktop_soundmind_app_api_spotify_my_sync_route_ts__WEBPACK_IMPORTED_MODULE_3__\n});\n// Pull out the exports that we need to expose from the module. This should\n// be eliminated when we've moved the other routes to the new format. These\n// are used to hook into the route.\nconst { requestAsyncStorage, staticGenerationAsyncStorage, serverHooks } = routeModule;\nconst originalPathname = \"/api/spotify/my/sync/route\";\nfunction patchFetch() {\n    return (0,next_dist_server_lib_patch_fetch__WEBPACK_IMPORTED_MODULE_2__.patchFetch)({\n        serverHooks,\n        staticGenerationAsyncStorage\n    });\n}\n\n\n//# sourceMappingURL=app-route.js.map//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9ub2RlX21vZHVsZXMvbmV4dC9kaXN0L2J1aWxkL3dlYnBhY2svbG9hZGVycy9uZXh0LWFwcC1sb2FkZXIuanM/bmFtZT1hcHAlMkZhcGklMkZzcG90aWZ5JTJGbXklMkZzeW5jJTJGcm91dGUmcGFnZT0lMkZhcGklMkZzcG90aWZ5JTJGbXklMkZzeW5jJTJGcm91dGUmYXBwUGF0aHM9JnBhZ2VQYXRoPXByaXZhdGUtbmV4dC1hcHAtZGlyJTJGYXBpJTJGc3BvdGlmeSUyRm15JTJGc3luYyUyRnJvdXRlLnRzJmFwcERpcj0lMkZVc2VycyUyRmNvcm1hY2tlcnIlMkZEZXNrdG9wJTJGc291bmRtaW5kJTJGYXBwJnBhZ2VFeHRlbnNpb25zPXRzeCZwYWdlRXh0ZW5zaW9ucz10cyZwYWdlRXh0ZW5zaW9ucz1qc3gmcGFnZUV4dGVuc2lvbnM9anMmcm9vdERpcj0lMkZVc2VycyUyRmNvcm1hY2tlcnIlMkZEZXNrdG9wJTJGc291bmRtaW5kJmlzRGV2PXRydWUmdHNjb25maWdQYXRoPXRzY29uZmlnLmpzb24mYmFzZVBhdGg9JmFzc2V0UHJlZml4PSZuZXh0Q29uZmlnT3V0cHV0PSZwcmVmZXJyZWRSZWdpb249Jm1pZGRsZXdhcmVDb25maWc9ZTMwJTNEISIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7QUFBc0c7QUFDdkM7QUFDYztBQUNvQjtBQUNqRztBQUNBO0FBQ0E7QUFDQSx3QkFBd0IsZ0hBQW1CO0FBQzNDO0FBQ0EsY0FBYyx5RUFBUztBQUN2QjtBQUNBO0FBQ0E7QUFDQTtBQUNBLEtBQUs7QUFDTDtBQUNBO0FBQ0EsWUFBWTtBQUNaLENBQUM7QUFDRDtBQUNBO0FBQ0E7QUFDQSxRQUFRLGlFQUFpRTtBQUN6RTtBQUNBO0FBQ0EsV0FBVyw0RUFBVztBQUN0QjtBQUNBO0FBQ0EsS0FBSztBQUNMO0FBQ3VIOztBQUV2SCIsInNvdXJjZXMiOlsid2VicGFjazovL3NvdW5kbWluZC8/NDAyMCJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBBcHBSb3V0ZVJvdXRlTW9kdWxlIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLW1vZHVsZXMvYXBwLXJvdXRlL21vZHVsZS5jb21waWxlZFwiO1xuaW1wb3J0IHsgUm91dGVLaW5kIH0gZnJvbSBcIm5leHQvZGlzdC9zZXJ2ZXIvZnV0dXJlL3JvdXRlLWtpbmRcIjtcbmltcG9ydCB7IHBhdGNoRmV0Y2ggYXMgX3BhdGNoRmV0Y2ggfSBmcm9tIFwibmV4dC9kaXN0L3NlcnZlci9saWIvcGF0Y2gtZmV0Y2hcIjtcbmltcG9ydCAqIGFzIHVzZXJsYW5kIGZyb20gXCIvVXNlcnMvY29ybWFja2Vyci9EZXNrdG9wL3NvdW5kbWluZC9hcHAvYXBpL3Nwb3RpZnkvbXkvc3luYy9yb3V0ZS50c1wiO1xuLy8gV2UgaW5qZWN0IHRoZSBuZXh0Q29uZmlnT3V0cHV0IGhlcmUgc28gdGhhdCB3ZSBjYW4gdXNlIHRoZW0gaW4gdGhlIHJvdXRlXG4vLyBtb2R1bGUuXG5jb25zdCBuZXh0Q29uZmlnT3V0cHV0ID0gXCJcIlxuY29uc3Qgcm91dGVNb2R1bGUgPSBuZXcgQXBwUm91dGVSb3V0ZU1vZHVsZSh7XG4gICAgZGVmaW5pdGlvbjoge1xuICAgICAgICBraW5kOiBSb3V0ZUtpbmQuQVBQX1JPVVRFLFxuICAgICAgICBwYWdlOiBcIi9hcGkvc3BvdGlmeS9teS9zeW5jL3JvdXRlXCIsXG4gICAgICAgIHBhdGhuYW1lOiBcIi9hcGkvc3BvdGlmeS9teS9zeW5jXCIsXG4gICAgICAgIGZpbGVuYW1lOiBcInJvdXRlXCIsXG4gICAgICAgIGJ1bmRsZVBhdGg6IFwiYXBwL2FwaS9zcG90aWZ5L215L3N5bmMvcm91dGVcIlxuICAgIH0sXG4gICAgcmVzb2x2ZWRQYWdlUGF0aDogXCIvVXNlcnMvY29ybWFja2Vyci9EZXNrdG9wL3NvdW5kbWluZC9hcHAvYXBpL3Nwb3RpZnkvbXkvc3luYy9yb3V0ZS50c1wiLFxuICAgIG5leHRDb25maWdPdXRwdXQsXG4gICAgdXNlcmxhbmRcbn0pO1xuLy8gUHVsbCBvdXQgdGhlIGV4cG9ydHMgdGhhdCB3ZSBuZWVkIHRvIGV4cG9zZSBmcm9tIHRoZSBtb2R1bGUuIFRoaXMgc2hvdWxkXG4vLyBiZSBlbGltaW5hdGVkIHdoZW4gd2UndmUgbW92ZWQgdGhlIG90aGVyIHJvdXRlcyB0byB0aGUgbmV3IGZvcm1hdC4gVGhlc2Vcbi8vIGFyZSB1c2VkIHRvIGhvb2sgaW50byB0aGUgcm91dGUuXG5jb25zdCB7IHJlcXVlc3RBc3luY1N0b3JhZ2UsIHN0YXRpY0dlbmVyYXRpb25Bc3luY1N0b3JhZ2UsIHNlcnZlckhvb2tzIH0gPSByb3V0ZU1vZHVsZTtcbmNvbnN0IG9yaWdpbmFsUGF0aG5hbWUgPSBcIi9hcGkvc3BvdGlmeS9teS9zeW5jL3JvdXRlXCI7XG5mdW5jdGlvbiBwYXRjaEZldGNoKCkge1xuICAgIHJldHVybiBfcGF0Y2hGZXRjaCh7XG4gICAgICAgIHNlcnZlckhvb2tzLFxuICAgICAgICBzdGF0aWNHZW5lcmF0aW9uQXN5bmNTdG9yYWdlXG4gICAgfSk7XG59XG5leHBvcnQgeyByb3V0ZU1vZHVsZSwgcmVxdWVzdEFzeW5jU3RvcmFnZSwgc3RhdGljR2VuZXJhdGlvbkFzeW5jU3RvcmFnZSwgc2VydmVySG9va3MsIG9yaWdpbmFsUGF0aG5hbWUsIHBhdGNoRmV0Y2gsICB9O1xuXG4vLyMgc291cmNlTWFwcGluZ1VSTD1hcHAtcm91dGUuanMubWFwIl0sIm5hbWVzIjpbXSwic291cmNlUm9vdCI6IiJ9\n//# sourceURL=webpack-internal:///(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute&page=%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute.ts&appDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!\n");

/***/ }),

/***/ "(rsc)/./app/api/spotify/my/sync/route.ts":
/*!******************************************!*\
  !*** ./app/api/spotify/my/sync/route.ts ***!
  \******************************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   POST: () => (/* binding */ POST)\n/* harmony export */ });\n/* harmony import */ var next_server__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! next/server */ \"(rsc)/./node_modules/next/dist/api/server.js\");\n/* harmony import */ var next_headers__WEBPACK_IMPORTED_MODULE_1__ = __webpack_require__(/*! next/headers */ \"(rsc)/./node_modules/next/dist/api/headers.js\");\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_3__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n/* harmony import */ var _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_2__ = __webpack_require__(/*! @/lib/supabaseAdmin */ \"(rsc)/./lib/supabaseAdmin.ts\");\n// app/api/spotify/my/sync/route.ts\n\n\n\n\nfunction getBearer() {\n    const h = (0,next_headers__WEBPACK_IMPORTED_MODULE_1__.headers)();\n    const a = h.get(\"authorization\") || h.get(\"Authorization\") || \"\";\n    const m = a.match(/^Bearer\\s+(.+)$/i);\n    return m ? m[1] : null;\n}\nasync function POST(req) {\n    try {\n        const url = new URL(req.url);\n        const full = url.searchParams.get(\"full\") === \"1\";\n        // 1) Identify the user with a user-scoped client\n        const bearer = getBearer();\n        if (!bearer) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: \"Missing bearer\"\n        }, {\n            status: 401\n        });\n        const userClient = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_3__.createClient)(\"https://awxeorfppxdsygnhxlth.supabase.co\", \"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImF3eGVvcmZwcHhkc3lnbmh4bHRoIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTQ2MTExOTUsImV4cCI6MjA3MDE4NzE5NX0.62qbnPYJc-UKAYiedhe9EhMcTTgO5iX6RniGKGr6rtk\", {\n            global: {\n                headers: {\n                    Authorization: `Bearer ${bearer}`\n                }\n            },\n            auth: {\n                persistSession: false\n            }\n        });\n        const { data: u, error: uErr } = await userClient.auth.getUser();\n        if (uErr || !u?.user) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: uErr?.message || \"No user\"\n        }, {\n            status: 401\n        });\n        const userId = u.user.id;\n        // 2) Read tokens with ADMIN client (bypass RLS)\n        const { data: acct, error: acctErr } = await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"spotify_accounts\").select(\"access_token, refresh_token, expires_at\").eq(\"user_id\", userId).maybeSingle();\n        if (acctErr || !acct) {\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: acctErr?.message || \"No Spotify account\"\n            }, {\n                status: 400\n            });\n        }\n        let accessToken = acct.access_token;\n        const refreshToken = acct.refresh_token;\n        const exp = acct.expires_at ? new Date(acct.expires_at).getTime() : 0;\n        // 3) Refresh if expiring\n        if (!accessToken || exp - Date.now() < 60000) {\n            const base = process.env.APP_BASE_URL || \"http://127.0.0.1:3000\";\n            const redirect = process.env.SPOTIFY_REDIRECT_URI || `${base}/api/spotify/callback`;\n            const resp = await fetch(\"https://accounts.spotify.com/api/token\", {\n                method: \"POST\",\n                headers: {\n                    \"Content-Type\": \"application/x-www-form-urlencoded\",\n                    Authorization: \"Basic \" + Buffer.from(`${process.env.SPOTIFY_CLIENT_ID}:${process.env.SPOTIFY_CLIENT_SECRET}`).toString(\"base64\")\n                },\n                body: new URLSearchParams({\n                    grant_type: \"refresh_token\",\n                    refresh_token: refreshToken,\n                    redirect_uri: redirect\n                })\n            });\n            if (!resp.ok) {\n                const text = await resp.text();\n                return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                    error: \"Refresh failed\",\n                    text\n                }, {\n                    status: 400\n                });\n            }\n            const t = await resp.json();\n            accessToken = t.access_token;\n            const newExp = new Date(Date.now() + Math.max(0, (t.expires_in ?? 3600) - 60) * 1000);\n            await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"spotify_accounts\").update({\n                access_token: accessToken,\n                refresh_token: t.refresh_token ?? refreshToken,\n                expires_at: newExp.toISOString()\n            }).eq(\"user_id\", userId);\n        }\n        // 4) Windowing\n        let afterParam = \"\";\n        if (!full) {\n            const { data: last } = await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"spotify_listens\").select(\"played_at\").eq(\"user_id\", userId).order(\"played_at\", {\n                ascending: false\n            }).limit(1).maybeSingle();\n            if (last?.played_at) afterParam = `&after=${new Date(last.played_at).getTime() + 1}`;\n        }\n        // 5) Fetch recently played\n        const apiUrl = `https://api.spotify.com/v1/me/player/recently-played?limit=50${afterParam}`;\n        const spRes = await fetch(apiUrl, {\n            headers: {\n                Authorization: `Bearer ${accessToken}`\n            }\n        });\n        if (!spRes.ok) {\n            const text = await spRes.text();\n            return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n                error: \"Spotify API error\",\n                status: spRes.status,\n                text\n            }, {\n                status: 400\n            });\n        }\n        const payload = await spRes.json();\n        const items = Array.isArray(payload.items) ? payload.items : [];\n        if (!items.length) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: true,\n            items_received: 0,\n            imported: 0\n        });\n        // 6) Build rows\n        const trackMap = new Map();\n        const listenMap = new Map();\n        for (const it of items){\n            const tr = it?.track;\n            if (!tr?.id) continue;\n            // Track row (dedupe by id)\n            if (!trackMap.has(tr.id)) {\n                const artistName = Array.isArray(tr.artists) ? tr.artists.map((a)=>a?.name).filter(Boolean).join(\", \") : null;\n                const img = tr.album?.images?.[0]?.url || null;\n                trackMap.set(tr.id, {\n                    id: tr.id,\n                    name: tr.name ?? null,\n                    artist_name: artistName,\n                    album_image_url: img,\n                    preview_url: tr.preview_url ?? null\n                });\n            }\n            // Listen row (dedupe by composite key)\n            const playedAtIso = it.played_at ? new Date(it.played_at).toISOString() : null;\n            if (playedAtIso) {\n                const key = `${userId}:${tr.id}:${playedAtIso}`;\n                if (!listenMap.has(key)) {\n                    listenMap.set(key, {\n                        user_id: userId,\n                        track_id: tr.id,\n                        played_at: playedAtIso\n                    });\n                }\n            }\n        }\n        const tracks = Array.from(trackMap.values());\n        const listens = Array.from(listenMap.values());\n        // 7) Write with ADMIN client (bypass RLS) — unique rows only\n        const { error: trErr } = await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"spotify_tracks\").upsert(tracks, {\n            onConflict: \"id\"\n        }); // safe because we deduped\n        if (trErr) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: trErr.message,\n            where: \"tracks.upsert\"\n        }, {\n            status: 400\n        });\n        const { error: lsErr } = await _lib_supabaseAdmin__WEBPACK_IMPORTED_MODULE_2__.supabaseAdmin.from(\"spotify_listens\").upsert(listens, {\n            onConflict: \"user_id,track_id,played_at\"\n        });\n        if (lsErr) return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: lsErr.message,\n            where: \"listens.upsert\"\n        }, {\n            status: 400\n        });\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            ok: true,\n            apiUrl,\n            items_received: items.length,\n            imported: listens.length\n        });\n    } catch (e) {\n        return next_server__WEBPACK_IMPORTED_MODULE_0__.NextResponse.json({\n            error: e?.message || String(e)\n        }, {\n            status: 500\n        });\n    }\n}\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QU0sRUFBRUQsT0FBT3lHLEtBQUssRUFBRSxHQUFHLE1BQU14SCw2REFBYUEsQ0FDekNvQyxJQUFJLENBQUMsbUJBQ0xpRixNQUFNLENBQUNGLFNBQVM7WUFBRUcsWUFBWTtRQUE2QjtRQUM5RCxJQUFJRSxPQUFPLE9BQU8zSCxxREFBWUEsQ0FBQ2lCLElBQUksQ0FBQztZQUFFQyxPQUFPeUcsTUFBTXpGLE9BQU87WUFBRXdGLE9BQU87UUFBaUIsR0FBRztZQUFFdkcsUUFBUTtRQUFJO1FBRXJHLE9BQU9uQixxREFBWUEsQ0FBQ2lCLElBQUksQ0FBQztZQUN2QmtELElBQUk7WUFDSmU7WUFDQU8sZ0JBQWdCSixNQUFNRyxNQUFNO1lBQzVCRSxVQUFVNEIsUUFBUTlCLE1BQU07UUFDMUI7SUFDRixFQUFFLE9BQU9vQyxHQUFRO1FBQ2YsT0FBTzVILHFEQUFZQSxDQUFDaUIsSUFBSSxDQUFDO1lBQUVDLE9BQU8wRyxHQUFHMUYsV0FBVzJGLE9BQU9EO1FBQUcsR0FBRztZQUFFekcsUUFBUTtRQUFJO0lBQzdFO0FBQ0YiLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zb3VuZG1pbmQvLi9hcHAvYXBpL3Nwb3RpZnkvbXkvc3luYy9yb3V0ZS50cz9iYzg1Il0sInNvdXJjZXNDb250ZW50IjpbIi8vIGFwcC9hcGkvc3BvdGlmeS9teS9zeW5jL3JvdXRlLnRzXG5pbXBvcnQgeyBOZXh0UmVzcG9uc2UgfSBmcm9tIFwibmV4dC9zZXJ2ZXJcIjtcbmltcG9ydCB7IGhlYWRlcnMgfSBmcm9tIFwibmV4dC9oZWFkZXJzXCI7XG5pbXBvcnQgeyBjcmVhdGVDbGllbnQgfSBmcm9tIFwiQHN1cGFiYXNlL3N1cGFiYXNlLWpzXCI7XG5pbXBvcnQgeyBzdXBhYmFzZUFkbWluIH0gZnJvbSBcIkAvbGliL3N1cGFiYXNlQWRtaW5cIjtcblxuZnVuY3Rpb24gZ2V0QmVhcmVyKCkge1xuICBjb25zdCBoID0gaGVhZGVycygpO1xuICBjb25zdCBhID0gaC5nZXQoXCJhdXRob3JpemF0aW9uXCIpIHx8IGguZ2V0KFwiQXV0aG9yaXphdGlvblwiKSB8fCBcIlwiO1xuICBjb25zdCBtID0gYS5tYXRjaCgvXkJlYXJlclxccysoLispJC9pKTtcbiAgcmV0dXJuIG0gPyBtWzFdIDogbnVsbDtcbn1cblxuZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIFBPU1QocmVxOiBSZXF1ZXN0KSB7XG4gIHRyeSB7XG4gICAgY29uc3QgdXJsID0gbmV3IFVSTChyZXEudXJsKTtcbiAgICBjb25zdCBmdWxsID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoXCJmdWxsXCIpID09PSBcIjFcIjtcblxuICAgIC8vIDEpIElkZW50aWZ5IHRoZSB1c2VyIHdpdGggYSB1c2VyLXNjb3BlZCBjbGllbnRcbiAgICBjb25zdCBiZWFyZXIgPSBnZXRCZWFyZXIoKTtcbiAgICBpZiAoIWJlYXJlcikgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiTWlzc2luZyBiZWFyZXJcIiB9LCB7IHN0YXR1czogNDAxIH0pO1xuXG4gICAgY29uc3QgdXNlckNsaWVudCA9IGNyZWF0ZUNsaWVudChcbiAgICAgIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCEsXG4gICAgICBwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSEsXG4gICAgICB7IGdsb2JhbDogeyBoZWFkZXJzOiB7IEF1dGhvcml6YXRpb246IGBCZWFyZXIgJHtiZWFyZXJ9YCB9IH0sIGF1dGg6IHsgcGVyc2lzdFNlc3Npb246IGZhbHNlIH0gfVxuICAgICk7XG4gICAgY29uc3QgeyBkYXRhOiB1LCBlcnJvcjogdUVyciB9ID0gYXdhaXQgdXNlckNsaWVudC5hdXRoLmdldFVzZXIoKTtcbiAgICBpZiAodUVyciB8fCAhdT8udXNlcikgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IHVFcnI/Lm1lc3NhZ2UgfHwgXCJObyB1c2VyXCIgfSwgeyBzdGF0dXM6IDQwMSB9KTtcbiAgICBjb25zdCB1c2VySWQgPSB1LnVzZXIuaWQ7XG5cbiAgICAvLyAyKSBSZWFkIHRva2VucyB3aXRoIEFETUlOIGNsaWVudCAoYnlwYXNzIFJMUylcbiAgICBjb25zdCB7IGRhdGE6IGFjY3QsIGVycm9yOiBhY2N0RXJyIH0gPSBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAuZnJvbShcInNwb3RpZnlfYWNjb3VudHNcIilcbiAgICAgIC5zZWxlY3QoXCJhY2Nlc3NfdG9rZW4sIHJlZnJlc2hfdG9rZW4sIGV4cGlyZXNfYXRcIilcbiAgICAgIC5lcShcInVzZXJfaWRcIiwgdXNlcklkKVxuICAgICAgLm1heWJlU2luZ2xlKCk7XG5cbiAgICBpZiAoYWNjdEVyciB8fCAhYWNjdCkge1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGFjY3RFcnI/Lm1lc3NhZ2UgfHwgXCJObyBTcG90aWZ5IGFjY291bnRcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xuICAgIH1cblxuICAgIGxldCBhY2Nlc3NUb2tlbiA9IGFjY3QuYWNjZXNzX3Rva2VuIGFzIHN0cmluZztcbiAgICBjb25zdCByZWZyZXNoVG9rZW4gPSBhY2N0LnJlZnJlc2hfdG9rZW4gYXMgc3RyaW5nO1xuICAgIGNvbnN0IGV4cCA9IGFjY3QuZXhwaXJlc19hdCA/IG5ldyBEYXRlKGFjY3QuZXhwaXJlc19hdCkuZ2V0VGltZSgpIDogMDtcblxuICAgIC8vIDMpIFJlZnJlc2ggaWYgZXhwaXJpbmdcbiAgICBpZiAoIWFjY2Vzc1Rva2VuIHx8IGV4cCAtIERhdGUubm93KCkgPCA2MF8wMDApIHtcbiAgICAgIGNvbnN0IGJhc2UgPSBwcm9jZXNzLmVudi5BUFBfQkFTRV9VUkwgfHwgXCJodHRwOi8vMTI3LjAuMC4xOjMwMDBcIjtcbiAgICAgIGNvbnN0IHJlZGlyZWN0ID0gcHJvY2Vzcy5lbnYuU1BPVElGWV9SRURJUkVDVF9VUkkgfHwgYCR7YmFzZX0vYXBpL3Nwb3RpZnkvY2FsbGJhY2tgO1xuXG4gICAgICBjb25zdCByZXNwID0gYXdhaXQgZmV0Y2goXCJodHRwczovL2FjY291bnRzLnNwb3RpZnkuY29tL2FwaS90b2tlblwiLCB7XG4gICAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICAgIGhlYWRlcnM6IHtcbiAgICAgICAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZFwiLFxuICAgICAgICAgIEF1dGhvcml6YXRpb246XG4gICAgICAgICAgICBcIkJhc2ljIFwiICtcbiAgICAgICAgICAgIEJ1ZmZlci5mcm9tKFxuICAgICAgICAgICAgICBgJHtwcm9jZXNzLmVudi5TUE9USUZZX0NMSUVOVF9JRH06JHtwcm9jZXNzLmVudi5TUE9USUZZX0NMSUVOVF9TRUNSRVR9YFxuICAgICAgICAgICAgKS50b1N0cmluZyhcImJhc2U2NFwiKSxcbiAgICAgICAgfSxcbiAgICAgICAgYm9keTogbmV3IFVSTFNlYXJjaFBhcmFtcyh7XG4gICAgICAgICAgZ3JhbnRfdHlwZTogXCJyZWZyZXNoX3Rva2VuXCIsXG4gICAgICAgICAgcmVmcmVzaF90b2tlbjogcmVmcmVzaFRva2VuLFxuICAgICAgICAgIHJlZGlyZWN0X3VyaTogcmVkaXJlY3QsXG4gICAgICAgIH0pLFxuICAgICAgfSk7XG5cbiAgICAgIGlmICghcmVzcC5vaykge1xuICAgICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgcmVzcC50ZXh0KCk7XG4gICAgICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBcIlJlZnJlc2ggZmFpbGVkXCIsIHRleHQgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IHQgPSBhd2FpdCByZXNwLmpzb24oKTtcbiAgICAgIGFjY2Vzc1Rva2VuID0gdC5hY2Nlc3NfdG9rZW47XG4gICAgICBjb25zdCBuZXdFeHAgPSBuZXcgRGF0ZShEYXRlLm5vdygpICsgTWF0aC5tYXgoMCwgKHQuZXhwaXJlc19pbiA/PyAzNjAwKSAtIDYwKSAqIDEwMDApO1xuXG4gICAgICBhd2FpdCBzdXBhYmFzZUFkbWluXG4gICAgICAgIC5mcm9tKFwic3BvdGlmeV9hY2NvdW50c1wiKVxuICAgICAgICAudXBkYXRlKHtcbiAgICAgICAgICBhY2Nlc3NfdG9rZW46IGFjY2Vzc1Rva2VuLFxuICAgICAgICAgIHJlZnJlc2hfdG9rZW46IHQucmVmcmVzaF90b2tlbiA/PyByZWZyZXNoVG9rZW4sXG4gICAgICAgICAgZXhwaXJlc19hdDogbmV3RXhwLnRvSVNPU3RyaW5nKCksXG4gICAgICAgIH0pXG4gICAgICAgIC5lcShcInVzZXJfaWRcIiwgdXNlcklkKTtcbiAgICB9XG5cbiAgICAvLyA0KSBXaW5kb3dpbmdcbiAgICBsZXQgYWZ0ZXJQYXJhbSA9IFwiXCI7XG4gICAgaWYgKCFmdWxsKSB7XG4gICAgICBjb25zdCB7IGRhdGE6IGxhc3QgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgICAgLmZyb20oXCJzcG90aWZ5X2xpc3RlbnNcIilcbiAgICAgICAgLnNlbGVjdChcInBsYXllZF9hdFwiKVxuICAgICAgICAuZXEoXCJ1c2VyX2lkXCIsIHVzZXJJZClcbiAgICAgICAgLm9yZGVyKFwicGxheWVkX2F0XCIsIHsgYXNjZW5kaW5nOiBmYWxzZSB9KVxuICAgICAgICAubGltaXQoMSlcbiAgICAgICAgLm1heWJlU2luZ2xlKCk7XG5cbiAgICAgIGlmIChsYXN0Py5wbGF5ZWRfYXQpIGFmdGVyUGFyYW0gPSBgJmFmdGVyPSR7bmV3IERhdGUobGFzdC5wbGF5ZWRfYXQpLmdldFRpbWUoKSArIDF9YDtcbiAgICB9XG5cbiAgICAvLyA1KSBGZXRjaCByZWNlbnRseSBwbGF5ZWRcbiAgICBjb25zdCBhcGlVcmwgPSBgaHR0cHM6Ly9hcGkuc3BvdGlmeS5jb20vdjEvbWUvcGxheWVyL3JlY2VudGx5LXBsYXllZD9saW1pdD01MCR7YWZ0ZXJQYXJhbX1gO1xuICAgIGNvbnN0IHNwUmVzID0gYXdhaXQgZmV0Y2goYXBpVXJsLCB7IGhlYWRlcnM6IHsgQXV0aG9yaXphdGlvbjogYEJlYXJlciAke2FjY2Vzc1Rva2VufWAgfSB9KTtcbiAgICBpZiAoIXNwUmVzLm9rKSB7XG4gICAgICBjb25zdCB0ZXh0ID0gYXdhaXQgc3BSZXMudGV4dCgpO1xuICAgICAgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IFwiU3BvdGlmeSBBUEkgZXJyb3JcIiwgc3RhdHVzOiBzcFJlcy5zdGF0dXMsIHRleHQgfSwgeyBzdGF0dXM6IDQwMCB9KTtcbiAgICB9XG4gICAgY29uc3QgcGF5bG9hZCA9IGF3YWl0IHNwUmVzLmpzb24oKTtcbiAgICBjb25zdCBpdGVtcyA9IEFycmF5LmlzQXJyYXkocGF5bG9hZC5pdGVtcykgPyBwYXlsb2FkLml0ZW1zIDogW107XG4gICAgaWYgKCFpdGVtcy5sZW5ndGgpIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IG9rOiB0cnVlLCBpdGVtc19yZWNlaXZlZDogMCwgaW1wb3J0ZWQ6IDAgfSk7XG5cbiAgICB0eXBlIFRyYWNrUm93ID0ge1xuICAgICAgaWQ6IHN0cmluZztcbiAgICAgIG5hbWU6IHN0cmluZyB8IG51bGw7XG4gICAgICBhcnRpc3RfbmFtZTogc3RyaW5nIHwgbnVsbDtcbiAgICAgIGFsYnVtX2ltYWdlX3VybDogc3RyaW5nIHwgbnVsbDtcbiAgICAgIHByZXZpZXdfdXJsOiBzdHJpbmcgfCBudWxsO1xuICAgIH07XG5cbiAgICAvLyA2KSBCdWlsZCByb3dzXG4gICAgY29uc3QgdHJhY2tNYXAgPSBuZXcgTWFwPHN0cmluZywgVHJhY2tSb3c+KCk7XG4gICAgY29uc3QgbGlzdGVuTWFwID0gbmV3IE1hcDxzdHJpbmcsIHsgdXNlcl9pZDogc3RyaW5nOyB0cmFja19pZDogc3RyaW5nOyBwbGF5ZWRfYXQ6IHN0cmluZyB9PigpO1xuXG4gICAgZm9yIChjb25zdCBpdCBvZiBpdGVtcykge1xuICAgICAgY29uc3QgdHIgPSBpdD8udHJhY2s7XG4gICAgICBpZiAoIXRyPy5pZCkgY29udGludWU7XG5cbiAgICAgIC8vIFRyYWNrIHJvdyAoZGVkdXBlIGJ5IGlkKVxuICAgICAgaWYgKCF0cmFja01hcC5oYXModHIuaWQpKSB7XG4gICAgICAgIGNvbnN0IGFydGlzdE5hbWUgPSBBcnJheS5pc0FycmF5KHRyLmFydGlzdHMpXG4gICAgICAgICAgPyB0ci5hcnRpc3RzLm1hcCgoYTogYW55KSA9PiBhPy5uYW1lKS5maWx0ZXIoQm9vbGVhbikuam9pbihcIiwgXCIpXG4gICAgICAgICAgOiBudWxsO1xuICAgICAgICBjb25zdCBpbWcgPSB0ci5hbGJ1bT8uaW1hZ2VzPy5bMF0/LnVybCB8fCBudWxsO1xuXG4gICAgICAgIHRyYWNrTWFwLnNldCh0ci5pZCwge1xuICAgICAgICAgIGlkOiB0ci5pZCxcbiAgICAgICAgICBuYW1lOiB0ci5uYW1lID8/IG51bGwsXG4gICAgICAgICAgYXJ0aXN0X25hbWU6IGFydGlzdE5hbWUsXG4gICAgICAgICAgYWxidW1faW1hZ2VfdXJsOiBpbWcsXG4gICAgICAgICAgcHJldmlld191cmw6IHRyLnByZXZpZXdfdXJsID8/IG51bGwsXG4gICAgICAgIH0pO1xuICAgICAgfVxuXG4gICAgICAvLyBMaXN0ZW4gcm93IChkZWR1cGUgYnkgY29tcG9zaXRlIGtleSlcbiAgICAgIGNvbnN0IHBsYXllZEF0SXNvID0gaXQucGxheWVkX2F0ID8gbmV3IERhdGUoaXQucGxheWVkX2F0KS50b0lTT1N0cmluZygpIDogbnVsbDtcbiAgICAgIGlmIChwbGF5ZWRBdElzbykge1xuICAgICAgICBjb25zdCBrZXkgPSBgJHt1c2VySWR9OiR7dHIuaWR9OiR7cGxheWVkQXRJc299YDtcbiAgICAgICAgaWYgKCFsaXN0ZW5NYXAuaGFzKGtleSkpIHtcbiAgICAgICAgICBsaXN0ZW5NYXAuc2V0KGtleSwgeyB1c2VyX2lkOiB1c2VySWQsIHRyYWNrX2lkOiB0ci5pZCwgcGxheWVkX2F0OiBwbGF5ZWRBdElzbyB9KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgIH1cblxuICAgIGNvbnN0IHRyYWNrcyA9IEFycmF5LmZyb20odHJhY2tNYXAudmFsdWVzKCkpO1xuICAgIGNvbnN0IGxpc3RlbnMgPSBBcnJheS5mcm9tKGxpc3Rlbk1hcC52YWx1ZXMoKSk7XG5cbiAgICAvLyA3KSBXcml0ZSB3aXRoIEFETUlOIGNsaWVudCAoYnlwYXNzIFJMUykg4oCUIHVuaXF1ZSByb3dzIG9ubHlcbiAgICBjb25zdCB7IGVycm9yOiB0ckVyciB9ID0gYXdhaXQgc3VwYWJhc2VBZG1pblxuICAgICAgLmZyb20oXCJzcG90aWZ5X3RyYWNrc1wiKVxuICAgICAgLnVwc2VydCh0cmFja3MsIHsgb25Db25mbGljdDogXCJpZFwiIH0pOyAvLyBzYWZlIGJlY2F1c2Ugd2UgZGVkdXBlZFxuICAgIGlmICh0ckVycikgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IHRyRXJyLm1lc3NhZ2UsIHdoZXJlOiBcInRyYWNrcy51cHNlcnRcIiB9LCB7IHN0YXR1czogNDAwIH0pO1xuXG4gICAgY29uc3QgeyBlcnJvcjogbHNFcnIgfSA9IGF3YWl0IHN1cGFiYXNlQWRtaW5cbiAgICAgIC5mcm9tKFwic3BvdGlmeV9saXN0ZW5zXCIpXG4gICAgICAudXBzZXJ0KGxpc3RlbnMsIHsgb25Db25mbGljdDogXCJ1c2VyX2lkLHRyYWNrX2lkLHBsYXllZF9hdFwiIH0pO1xuICAgIGlmIChsc0VycikgcmV0dXJuIE5leHRSZXNwb25zZS5qc29uKHsgZXJyb3I6IGxzRXJyLm1lc3NhZ2UsIHdoZXJlOiBcImxpc3RlbnMudXBzZXJ0XCIgfSwgeyBzdGF0dXM6IDQwMCB9KTtcblxuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7XG4gICAgICBvazogdHJ1ZSxcbiAgICAgIGFwaVVybCxcbiAgICAgIGl0ZW1zX3JlY2VpdmVkOiBpdGVtcy5sZW5ndGgsXG4gICAgICBpbXBvcnRlZDogbGlzdGVucy5sZW5ndGgsXG4gICAgfSk7XG4gIH0gY2F0Y2ggKGU6IGFueSkge1xuICAgIHJldHVybiBOZXh0UmVzcG9uc2UuanNvbih7IGVycm9yOiBlPy5tZXNzYWdlIHx8IFN0cmluZyhlKSB9LCB7IHN0YXR1czogNTAwIH0pO1xuICB9XG59XG4iXSwibmFtZXMiOlsiTmV4dFJlc3BvbnNlIiwiaGVhZGVycyIsImNyZWF0ZUNsaWVudCIsInN1cGFiYXNlQWRtaW4iLCJnZXRCZWFyZXIiLCJoIiwiYSIsImdldCIsIm0iLCJtYXRjaCIsIlBPU1QiLCJyZXEiLCJ1cmwiLCJVUkwiLCJmdWxsIiwic2VhcmNoUGFyYW1zIiwiYmVhcmVyIiwianNvbiIsImVycm9yIiwic3RhdHVzIiwidXNlckNsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9BTk9OX0tFWSIsImdsb2JhbCIsIkF1dGhvcml6YXRpb24iLCJhdXRoIiwicGVyc2lzdFNlc3Npb24iLCJkYXRhIiwidSIsInVFcnIiLCJnZXRVc2VyIiwidXNlciIsIm1lc3NhZ2UiLCJ1c2VySWQiLCJpZCIsImFjY3QiLCJhY2N0RXJyIiwiZnJvbSIsInNlbGVjdCIsImVxIiwibWF5YmVTaW5nbGUiLCJhY2Nlc3NUb2tlbiIsImFjY2Vzc190b2tlbiIsInJlZnJlc2hUb2tlbiIsInJlZnJlc2hfdG9rZW4iLCJleHAiLCJleHBpcmVzX2F0IiwiRGF0ZSIsImdldFRpbWUiLCJub3ciLCJiYXNlIiwiQVBQX0JBU0VfVVJMIiwicmVkaXJlY3QiLCJTUE9USUZZX1JFRElSRUNUX1VSSSIsInJlc3AiLCJmZXRjaCIsIm1ldGhvZCIsIkJ1ZmZlciIsIlNQT1RJRllfQ0xJRU5UX0lEIiwiU1BPVElGWV9DTElFTlRfU0VDUkVUIiwidG9TdHJpbmciLCJib2R5IiwiVVJMU2VhcmNoUGFyYW1zIiwiZ3JhbnRfdHlwZSIsInJlZGlyZWN0X3VyaSIsIm9rIiwidGV4dCIsInQiLCJuZXdFeHAiLCJNYXRoIiwibWF4IiwiZXhwaXJlc19pbiIsInVwZGF0ZSIsInRvSVNPU3RyaW5nIiwiYWZ0ZXJQYXJhbSIsImxhc3QiLCJvcmRlciIsImFzY2VuZGluZyIsImxpbWl0IiwicGxheWVkX2F0IiwiYXBpVXJsIiwic3BSZXMiLCJwYXlsb2FkIiwiaXRlbXMiLCJBcnJheSIsImlzQXJyYXkiLCJsZW5ndGgiLCJpdGVtc19yZWNlaXZlZCIsImltcG9ydGVkIiwidHJhY2tNYXAiLCJNYXAiLCJsaXN0ZW5NYXAiLCJpdCIsInRyIiwidHJhY2siLCJoYXMiLCJhcnRpc3ROYW1lIiwiYXJ0aXN0cyIsIm1hcCIsIm5hbWUiLCJmaWx0ZXIiLCJCb29sZWFuIiwiam9pbiIsImltZyIsImFsYnVtIiwiaW1hZ2VzIiwic2V0IiwiYXJ0aXN0X25hbWUiLCJhbGJ1bV9pbWFnZV91cmwiLCJwcmV2aWV3X3VybCIsInBsYXllZEF0SXNvIiwia2V5IiwidXNlcl9pZCIsInRyYWNrX2lkIiwidHJhY2tzIiwidmFsdWVzIiwibGlzdGVucyIsInRyRXJyIiwidXBzZXJ0Iiwib25Db25mbGljdCIsIndoZXJlIiwibHNFcnIiLCJlIiwiU3RyaW5nIl0sInNvdXJjZVJvb3QiOiIifQ==\n//# sourceURL=webpack-internal:///(rsc)/./app/api/spotify/my/sync/route.ts\n");

/***/ }),

/***/ "(rsc)/./lib/supabaseAdmin.ts":
/*!******************************!*\
  !*** ./lib/supabaseAdmin.ts ***!
  \******************************/
/***/ ((__unused_webpack_module, __webpack_exports__, __webpack_require__) => {

eval("__webpack_require__.r(__webpack_exports__);\n/* harmony export */ __webpack_require__.d(__webpack_exports__, {\n/* harmony export */   supabaseAdmin: () => (/* binding */ supabaseAdmin)\n/* harmony export */ });\n/* harmony import */ var _supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__ = __webpack_require__(/*! @supabase/supabase-js */ \"(rsc)/./node_modules/@supabase/supabase-js/dist/module/index.js\");\n// lib/supabaseAdmin.ts\n\nif (false) {}\nif (!process.env.SUPABASE_SERVICE_ROLE_KEY) throw new Error(\"Missing SUPABASE_SERVICE_ROLE_KEY\");\nconst supabaseAdmin = (0,_supabase_supabase_js__WEBPACK_IMPORTED_MODULE_0__.createClient)(\"https://awxeorfppxdsygnhxlth.supabase.co\", process.env.SUPABASE_SERVICE_ROLE_KEY, {\n    auth: {\n        persistSession: false,\n        autoRefreshToken: false\n    }\n});\n//# sourceURL=[module]\n//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiKHJzYykvLi9saWIvc3VwYWJhc2VBZG1pbi50cyIsIm1hcHBpbmdzIjoiOzs7OztBQUFBLHVCQUF1QjtBQUM4QjtBQUVyRCxJQUFJLEtBQXFDLEVBQUUsRUFBb0Q7QUFDL0YsSUFBSSxDQUFDQyxRQUFRQyxHQUFHLENBQUNHLHlCQUF5QixFQUFFLE1BQU0sSUFBSUQsTUFBTTtBQUVyRCxNQUFNRSxnQkFBZ0JOLG1FQUFZQSxDQUN2Q0MsMENBQW9DLEVBQ3BDQSxRQUFRQyxHQUFHLENBQUNHLHlCQUF5QixFQUNyQztJQUNFRSxNQUFNO1FBQUVDLGdCQUFnQjtRQUFPQyxrQkFBa0I7SUFBTTtBQUN6RCxHQUNBIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc291bmRtaW5kLy4vbGliL3N1cGFiYXNlQWRtaW4udHM/MDlkNSJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBsaWIvc3VwYWJhc2VBZG1pbi50c1xuaW1wb3J0IHsgY3JlYXRlQ2xpZW50IH0gZnJvbSBcIkBzdXBhYmFzZS9zdXBhYmFzZS1qc1wiO1xuXG5pZiAoIXByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCkgdGhyb3cgbmV3IEVycm9yKFwiTWlzc2luZyBORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkxcIik7XG5pZiAoIXByb2Nlc3MuZW52LlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkpIHRocm93IG5ldyBFcnJvcihcIk1pc3NpbmcgU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWVwiKTtcblxuZXhwb3J0IGNvbnN0IHN1cGFiYXNlQWRtaW4gPSBjcmVhdGVDbGllbnQoXG4gIHByb2Nlc3MuZW52Lk5FWFRfUFVCTElDX1NVUEFCQVNFX1VSTCxcbiAgcHJvY2Vzcy5lbnYuU1VQQUJBU0VfU0VSVklDRV9ST0xFX0tFWSxcbiAge1xuICAgIGF1dGg6IHsgcGVyc2lzdFNlc3Npb246IGZhbHNlLCBhdXRvUmVmcmVzaFRva2VuOiBmYWxzZSB9LFxuICB9XG4pO1xuIl0sIm5hbWVzIjpbImNyZWF0ZUNsaWVudCIsInByb2Nlc3MiLCJlbnYiLCJORVhUX1BVQkxJQ19TVVBBQkFTRV9VUkwiLCJFcnJvciIsIlNVUEFCQVNFX1NFUlZJQ0VfUk9MRV9LRVkiLCJzdXBhYmFzZUFkbWluIiwiYXV0aCIsInBlcnNpc3RTZXNzaW9uIiwiYXV0b1JlZnJlc2hUb2tlbiJdLCJzb3VyY2VSb290IjoiIn0=\n//# sourceURL=webpack-internal:///(rsc)/./lib/supabaseAdmin.ts\n");

/***/ })

};
;

// load runtime
var __webpack_require__ = require("../../../../../webpack-runtime.js");
__webpack_require__.C(exports);
var __webpack_exec__ = (moduleId) => (__webpack_require__(__webpack_require__.s = moduleId))
var __webpack_exports__ = __webpack_require__.X(0, ["vendor-chunks/next","vendor-chunks/@supabase","vendor-chunks/tr46","vendor-chunks/whatwg-url","vendor-chunks/webidl-conversions"], () => (__webpack_exec__("(rsc)/./node_modules/next/dist/build/webpack/loaders/next-app-loader.js?name=app%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute&page=%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute&appPaths=&pagePath=private-next-app-dir%2Fapi%2Fspotify%2Fmy%2Fsync%2Froute.ts&appDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind%2Fapp&pageExtensions=tsx&pageExtensions=ts&pageExtensions=jsx&pageExtensions=js&rootDir=%2FUsers%2Fcormackerr%2FDesktop%2Fsoundmind&isDev=true&tsconfigPath=tsconfig.json&basePath=&assetPrefix=&nextConfigOutput=&preferredRegion=&middlewareConfig=e30%3D!")));
module.exports = __webpack_exports__;

})();